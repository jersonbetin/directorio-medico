extends layout

block css
  link(rel="stylesheet", href='/stylesheets/less/home/general.css')

block nav
  button.navbar-toggle(type="button", data-toggle="collapse", data-target="#bs-example-navbar-collapse-1")
    span.sr-only toogle navigation
    span.icon-bar
    span.icon-bar
    span.icon-bar
  a.navbar-brand(href='/') CONSULTING
  #bs-example-navbar-collapse-1.navbar-collapse.collapse
    ul.nav.navbar-nav
      li.active
        a() 
          i.fa.fa-bars
          |  Dashboard
      li
        a(href="/me/patient_information")
          i.fa.fa-info-circle
          |  Mi informacion
      li.dropdown
        a(href="#", class="dropdown-toggle", data-toggle="dropdown") 
          i.fa.fa-code-fork
          |   Operaciones
          b.caret
        ul.dropdown-menu
          li
            a(href="/me/personal_information")
              i.fa.fa-star
              |   Tomar citas medicas
          li
            a(href="/me/professional_information")
              i.fa.fa-star
              |  Consulta de idoneidad medica
      li
        a#logout_patient(href="#")
          i.fa.fa-sign-out
          |  Cerrar session
block content
  .container.general-content
    .row
      .col-lg-8
        h2#username_h2 Bienvenido Paciente:
        input#csrf_input(type="hidden", value="#{data.csrf}")

block js
  script.
    $(document).on('ready', function(){
      function logoutDoctorSuccess(data, textStatus, jqXHR){
          console.log(data);
          if(data){
            if(data.error){
              console.log(error);
            }else{
              localStorage.removeItem("accessToken");
              localStorage.removeItem("refreshToken");
              localStorage.removeItem("tokenType");
              localStorage.removeItem("expirationDate");
              window.location.replace("/");
            }
          }
        }

        function getPatientAccountInformationSuccess(data){
          var patientAI = {};
          patientAI = data.patientAccountInformation;
          $("#username_h2").html("Bienvenido Paciente: "+patientAI.username);
        }

        function getPatientAccountInformation (){
          $.ajax({
            url:"/api/v1/patients/me/account_information",
            headers: {
              "accessToken": localStorage.accessToken
            },
            success: getPatientAccountInformationSuccess
          });
        }

        $("#logout_patient").on('click', function(e){
          e.preventDefault();
          $.ajax({
            type: "DELETE",
            url:"/login/patients",
            headers: {
              "csrfToken": $("#csrf_input").val()
            },
            success: logoutDoctorSuccess
          });
        }); // End of logout doctor on click event
        getPatientAccountInformation ();
      });